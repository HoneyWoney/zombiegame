<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Zombie War 1ì°¨ ì„¸ê³„</title>
  <style>
    /* ê³µí†µ */
    body, html {
      margin:0; padding:0;
      height:100%; overflow:hidden;
      font-family:sans-serif;
    }
    button {
      padding:12px 24px;
      font-size:18px;
      cursor:pointer;
      border:none;
      border-radius:4px;
      background:#ffcc00;
      color:#333;
      box-shadow:1px 1px 5px rgba(0,0,0,0.3);
    }

    /* ëª¨ë“  í™”ë©´(ìŠ¤í¬ë¦°) ê¸°ë³¸ ì„¤ì • */
    .screen {
      position:absolute; top:0; left:0;
      width:100%; height:100%;
      display:none;
    }

    /* 1) ì¸íŠ¸ë¡œ í™”ë©´ */
    #introScreen {
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      /* ì„¸ë¡œ ì´ë¯¸ì§€ê°€ ì˜ ë³´ì´ë„ë¡ ë†’ì´ì— ë§ì¶° ëŠ˜ë¦¬ê¸° */
      background: url('intro.png') no-repeat center top;
      background-size: auto 100%;
    }
    #introScreen .btn-group {
      display:flex;
      flex-direction:column;
      gap:16px;
      margin-top:20px;
    }

    /* 2) ì •ë³´ í™”ë©´ */
    #infoScreen {
      display:flex;
      flex-direction:column;
      background:#222;
      color:#eee;
      padding:24px;
      box-sizing:border-box;
      overflow-y:auto;
    }
    #infoScreen button {
      align-self:flex-start;
      margin-bottom:16px;
      background:#444; color:#fff;
    }
    #infoScreen h2 { margin-top:0; }

    /* 3) ê²Œì„ í™”ë©´ */
    #gameScreen {
      display:flex;
      flex-direction:column;
      background:#000;
    }
    canvas {
      flex:1;
      background:#111;
      display:block;
    }
    #hud {
      position:absolute;
      top:8px; left:8px;
      color:#fff;
      font-size:14px;
      line-height:1.4;
      text-shadow:1px 1px 2px #000;
    }
  </style>
</head>
<body>

  <!-- ì¸íŠ¸ë¡œ -->
  <div id="introScreen" class="screen">
    <div class="btn-group">
      <button id="btnStart">ê²Œì„ ì‹œì‘</button>
      <button id="btnInfo">ì¡°ì‘ë²• & ì•„ì´í…œ ì„¤ëª…</button>
    </div>
  </div>

  <!-- ì •ë³´ -->
  <div id="infoScreen" class="screen">
    <button id="btnBack">â—€ ë’¤ë¡œê°€ê¸°</button>
    <h2>ì¡°ì‘ë²•</h2>
    <ul>
      <li>í‚¤ë³´ë“œ: í™”ì‚´í‘œ / WASDë¡œ ì´ë™</li>
      <li>ë§ˆìš°ìŠ¤/í„°ì¹˜: ì›í•˜ëŠ” ìœ„ì¹˜ í´ë¦­í•˜ê±°ë‚˜ ë“œë˜ê·¸</li>
    </ul>
    <h2>ì•„ì´í…œ ì„¤ëª…</h2>
    <ul>
      <!-- ìˆœì„œë¥¼ ë¡œí”„ â†’ ê°ì˜¥ ìœ¼ë¡œ êµì²´ -->
      <li><strong>ë°§ì¤„(rope)</strong>: ì¶©ëŒ ì‹œ ë°§ì¤„ 1ê°œ ì†Œëª¨, ì¦‰ì‹œ í¬íš</li>
      <li><strong>ì² ì°½(prison)</strong>: í¬íší•œ ì¢€ë¹„ë¥¼ ê°ì˜¥ì— ê°€ë‘¡ë‹ˆë‹¤</li>
      <li><strong>ë‚˜ë…¸ì˜·(nano)</strong>: ì¶©ëŒ ì‹œ ë‚˜ë…¸ì˜· 1ê°œ ì†Œëª¨, 3ì´ˆê°„ ë¬´ì </li>
      <li><strong>ì±„ì·¨ë©´ë´‰(swab)</strong>: ê°ì˜¥ ì† ì¢€ë¹„ê°€ ìˆì„ ë•Œ ì‚¬ìš© â†’ ì ìˆ˜+1</li>
    </ul>
  </div>

  <!-- ê²Œì„ -->
  <div id="gameScreen" class="screen">
    <canvas id="gameCanvas"></canvas>
    <div id="hud"></div>
  </div>

  <script>
  (()=>{

    // --- í™”ë©´ ì „í™˜ í—¬í¼ ---
    const show = id => {
      document.querySelectorAll('.screen').forEach(s=>s.style.display='none');
      document.getElementById(id).style.display = 'flex';
    };

    // ëª¨ë°”ì¼ ì—¬ë¶€ ì²´í¬
    const isMobile = () => /Mobi|Android|iPhone|iPad|iPod/.test(navigator.userAgent);

    // ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
    document.getElementById('btnStart').onclick = ()=>{
      // ëª¨ë°”ì¼ ì„¸ë¡œ ëª¨ë“œì—ì„œëŠ” ê°€ë¡œ ì „í™˜ ì•ˆë‚´
      if(isMobile() && window.innerWidth < window.innerHeight){
        alert('ëª¨ë°”ì¼ì—ì„œëŠ” ê°€ë¡œ ëª¨ë“œë¡œ ì „í™˜ í›„ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤.');
        window.addEventListener('orientationchange', function onrot(){
          if(window.innerWidth > window.innerHeight){
            window.removeEventListener('orientationchange', onrot);
            show('gameScreen');
            startGame();
          }
        });
      } else {
        show('gameScreen');
        startGame();
      }
    };
    document.getElementById('btnInfo').onclick = ()=> show('infoScreen');
    document.getElementById('btnBack').onclick = ()=> show('introScreen');

    // ìµœì´ˆì—” ì¸íŠ¸ë¡œ ë³´ì—¬ì£¼ê¸°
    show('introScreen');

    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    //         ì—¬ê¸°ì„œë¶€í„° ê²Œì„ ë¡œì§
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

    const canvas = document.getElementById('gameCanvas'),
          ctx    = canvas.getContext('2d');
    let WIDTH, HEIGHT;
    function resize(){
      WIDTH  = canvas.width  = window.innerWidth;
      HEIGHT = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    const FPS = 60;
    // ì…ë ¥ ì²˜ë¦¬: í‚¤ë³´ë“œ + ë§ˆìš°ìŠ¤/í„°ì¹˜
    const keys = {}, ptr = {down:false,x:0,y:0};
    window.addEventListener('keydown', e=> keys[e.key]=true);
    window.addEventListener('keyup',   e=> keys[e.key]=false);

    canvas.addEventListener('mousedown',e=>{ ptr.down=true; upd(e); });
    canvas.addEventListener('mousemove',e=>{ if(ptr.down) upd(e); });
    window.addEventListener('mouseup', ()=> ptr.down=false);

    canvas.addEventListener('touchstart',e=>{ ptr.down=true; upd(e.touches[0]); });
    canvas.addEventListener('touchmove', e=> upd(e.touches[0]));
    canvas.addEventListener('touchend',  ()=> ptr.down=false);

    function upd(e){ ptr.x=e.clientX; ptr.y=e.clientY; }

    function isColliding(a,b){
      return !(a.x+a.size < b.x ||
               a.x     > b.x+b.size ||
               a.y+a.size < b.y ||
               a.y     > b.y+b.size);
    }

    // ì´ë¯¸ì§€ ë¡œë“œ
    const list = {
      bg:'bg.png', player:'player.png', zombie:'zombie.png',
      rope:'rope.png', prison:'prison.png', swab:'swab.png', nano:'nano.png'
    };
    const assets = {};
    let ld=0, tot=Object.keys(list).length;
    for(let k in list){
      assets[k] = new Image();
      assets[k].src = list[k];
      assets[k].onload = ()=>{ if(++ld===tot) {/* ì¤€ë¹„ ì™„ë£Œ */} };
    }

    // í¬ê¸° ì„¤ì •
    const SPR = { player:60, zombie:50, item:36 };

    // === Player ===
    class Player {
      constructor(){
        this.size = SPR.player;
        this.x = WIDTH/2; this.y = HEIGHT/2;
        this.speed=4; this.health=2;
        this.ropeCount=0; this.nanoCount=0;
        this.captured=0; this.imprisoned=0; this.score=0;
        this.invincibleTimer=0;
      }
      update(){
        if(keys['ArrowLeft']||keys['a']) this.x-=this.speed;
        if(keys['ArrowRight']||keys['d']) this.x+=this.speed;
        if(keys['ArrowUp']||keys['w']) this.y-=this.speed;
        if(keys['ArrowDown']||keys['s']) this.y+=this.speed;
        if(ptr.down){
          const dx=ptr.x-this.x, dy=ptr.y-this.y;
          const d=Math.hypot(dx,dy)||1;
          this.x+=dx/d*this.speed; this.y+=dy/d*this.speed;
        }
        this.x=Math.max(0,Math.min(WIDTH-this.size,this.x));
        this.y=Math.max(0,Math.min(HEIGHT-this.size,this.y));
        if(this.invincibleTimer>0) this.invincibleTimer--;
      }
      draw(){
        if(this.invincibleTimer>0 && Math.floor(this.invincibleTimer/10)%2===0) return;
        ctx.drawImage(assets.player,this.x,this.y,this.size,this.size);
      }
    }

    // === Zombie ===
    class Zombie {
      constructor(){ this.size=SPR.zombie; this.speed=1.2; this.reset(); }
      reset(){
        this.x=Math.random()*(WIDTH-this.size);
        this.y=Math.random()*(HEIGHT-this.size);
      }
      update(p){
        const dx=p.x-this.x, dy=p.y-this.y, d=Math.hypot(dx,dy)||1;
        this.x+=dx/d*this.speed; this.y+=dy/d*this.speed;
      }
      draw(){ ctx.drawImage(assets.zombie,this.x,this.y,this.size,this.size) }
    }

    // === Item ===
    class Item {
      constructor(t){ this.type=t; this.size=SPR.item; this.reset(); }
      reset(){
        this.x=Math.random()*(WIDTH-this.size);
        this.y=Math.random()*(HEIGHT-this.size);
      }
      draw(){ ctx.drawImage(assets[this.type],this.x,this.y,this.size,this.size) }
    }

    // === Game Start ===
    function startGame(){
      const player=new Player();
      const zombies=Array.from({length:5},()=>new Zombie());
      const items=Array.from({length:8},()=>new Item(
        ['rope','prison','swab','nano'][Math.floor(Math.random()*4)]
      ));
      const collected={ rope:0, prison:0, swab:0, nano:0 };

      function loop(){
        // ë°°ê²½
        ctx.drawImage(assets.bg,0,0,WIDTH,HEIGHT);

        // ì—…ë°ì´íŠ¸
        player.update(); zombies.forEach(z=>z.update(player));

        // ì•„ì´í…œ ì¶©ëŒ & ë¦¬ìŠ¤í°
        items.forEach(it=>{
          if(isColliding(player,it)){
            collected[it.type]++;
            switch(it.type){
              case 'rope': player.ropeCount++; break;
              case 'prison':
                if(player.captured>0){ player.imprisoned++; player.captured--; }
                break;
              case 'swab':
                if(player.imprisoned>0){ player.score++; player.imprisoned--; }
                break;
              case 'nano': player.nanoCount++; break;
            }
            it.reset();
          }
        });

        // ì¢€ë¹„ ì¶©ëŒ
        zombies.forEach(z=>{
          if(isColliding(player,z)){
            if(player.ropeCount>0){
              player.ropeCount--; player.captured++; z.reset();
            }
            else if(player.nanoCount>0){
              player.nanoCount--; player.invincibleTimer=FPS*3;
            }
            else if(player.invincibleTimer===0){
              player.health--; player.invincibleTimer=FPS*3; z.reset();
            }
          }
        });

        // ê·¸ë¦¬ê¸°
        player.draw(); zombies.forEach(z=>z.draw()); items.forEach(it=>it.draw());

        // HUD ì—…ë°ì´íŠ¸
        document.getElementById('hud').innerHTML=
          `â¤ì²´ë ¥:${player.health} ğŸ”—ë¡œí”„:${player.ropeCount}`+
          ` ğŸ‘•ë‚˜ë…¸:${player.nanoCount} ğŸ“¦ê°ì˜¥:${player.imprisoned}`+
          ` â­ì ìˆ˜:${player.score}<br>`+
          `íšë“â–¶ë¡œí”„:${collected.rope} ê°ì˜¥:${collected.prison}`+
          ` ë©´ë´‰:${collected.swab} ë‚˜ë…¸:${collected.nano}`;

        // ê²Œì„ì˜¤ë²„
        if(player.health<=0){
          alert('ê²Œì„ ì˜¤ë²„!\nìµœì¢… ì ìˆ˜:'+player.score);
          window.location.reload();
          return;
        }
        requestAnimationFrame(loop);
      }
      loop();
    }

  })();
  </script>
</body>
</html>
