<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Zombie War 1ì°¨ ì„¸ê³„</title>
  <style>
    /* ê³µí†µ */
    body, html { margin:0; padding:0; height:100%; overflow:hidden; font-family: sans-serif; }
    button { padding:10px 20px; font-size:16px; cursor:pointer; }
    /* í™”ë©´ êµ¬ë¶„ ì„¹ì…˜ */
    .screen { position:absolute; top:0; left:0; width:100%; height:100%; display:none; }
    /* ì¸íŠ¸ë¡œ í™”ë©´ */
    #introScreen {
      background: url('intro.png') center/cover no-repeat;
      display:flex; flex-direction:column; justify-content:flex-end; align-items:center;
      padding-bottom:100px;
    }
    #introScreen button { margin:10px; }
    /* ì •ë³´ í™”ë©´ */
    #infoScreen {
      background: #222;
      color: #eee;
      padding:20px;
      box-sizing:border-box;
      overflow-y:auto;
    }
    #infoScreen h2 { margin-top:0; }
    /* ê²Œì„ í™”ë©´ */
    #gameScreen { background:#000; }
    canvas { display:block; margin:0 auto; background:#111; }
    /* HUD */
    #hud {
      position:absolute; top:10px; left:10px; color:#fff;
      font-size:14px; line-height:1.5;
      text-shadow: 1px 1px 2px #000;
    }
  </style>
</head>
<body>

  <!-- 1) ì¸íŠ¸ë¡œ í™”ë©´ -->
  <div id="introScreen" class="screen">
    <button id="btnStart">ê²Œì„ ì‹œì‘</button>
    <button id="btnInfo">ì¡°ì‘ë²• & ì•„ì´í…œ ì„¤ëª…</button>
  </div>

  <!-- 2) ì •ë³´ í™”ë©´ -->
  <div id="infoScreen" class="screen">
    <button id="btnBack">â—€ ë’¤ë¡œê°€ê¸°</button>
    <h2>ì¡°ì‘ë²•</h2>
    <ul>
      <li>í‚¤ë³´ë“œ: í™”ì‚´í‘œ / WASDë¡œ ì´ë™</li>
      <li>ë§ˆìš°ìŠ¤/í„°ì¹˜: ì›í•˜ëŠ” ìœ„ì¹˜ í´ë¦­ ë˜ëŠ” ë“œë˜ê·¸</li>
    </ul>
    <h2>ì•„ì´í…œ ì„¤ëª…</h2>
    <ul>
      <li><strong>ì² ì°½</strong>(prison): í¬íší•œ ì¢€ë¹„ë¥¼ ê°ì˜¥ì— ê°€ë‘¡ë‹ˆë‹¤.</li>
      <li><strong>ë°§ì¤„</strong>(rope): ì¢€ë¹„ ì¶©ëŒ ì‹œ ë°§ì¤„ 1ê°œë¥¼ ì†Œëª¨í•´ ì¦‰ì‹œ í¬íš.</li>
      <li><strong>ë‚˜ë…¸ì˜·</strong>(nano): ì¶©ëŒ ì‹œ ë‚˜ë…¸ì˜· 1ê°œ ì†Œëª¨, 3ì´ˆê°„ ë¬´ì .</li>
      <li><strong>ì±„ì·¨ë©´ë´‰</strong>(swab): ê°ì˜¥ì— ê°‡íŒ ì¢€ë¹„ê°€ ìˆì„ ë•Œ ì‚¬ìš© â†’ ì ìˆ˜+1.</li>
    </ul>
  </div>

  <!-- 3) ê²Œì„ í™”ë©´ -->
  <div id="gameScreen" class="screen">
    <canvas id="gameCanvas"></canvas>
    <div id="hud"></div>
  </div>

  <script>
  (()=>{

    // í™”ë©´ ì „í™˜ í•¨ìˆ˜
    const show = id => {
      document.querySelectorAll('.screen').forEach(s=>s.style.display='none');
      document.getElementById(id).style.display='flex';
    };

    // ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('btnStart').onclick = () => {
      show('gameScreen');
      startGame();
    };
    document.getElementById('btnInfo').onclick  = ()=> show('infoScreen');
    document.getElementById('btnBack').onclick  = ()=> show('introScreen');

    // ì²˜ìŒì—” ì¸íŠ¸ë¡œ í™”ë©´
    show('introScreen');

    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    // ê²Œì„ ë¡œì§
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

    // ìº”ë²„ìŠ¤ ì´ˆê¸°í™” & í™”ë©´ í¬ê¸° ë§ì¶¤
    const canvas = document.getElementById('gameCanvas');
    const ctx    = canvas.getContext('2d');
    let WIDTH, HEIGHT;
    function resize(){
      WIDTH  = canvas.width  = window.innerWidth;
      HEIGHT = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    const FPS = 60;
    // í‚¤ë³´ë“œ, ë§ˆìš°ìŠ¤, í„°ì¹˜ ì…ë ¥
    const keys = {}, pointer = {down:false,x:0,y:0};
    window.addEventListener('keydown', e=> keys[e.key]=true);
    window.addEventListener('keyup',   e=> keys[e.key]=false);
    canvas.addEventListener('mousedown',e=>{pointer.down=true;updatePointer(e);});
    canvas.addEventListener('mousemove',e=>{ if(pointer.down) updatePointer(e); });
    window.addEventListener('mouseup',  ()=>pointer.down=false);
    canvas.addEventListener('touchstart',e=>{pointer.down=true;updatePointer(e.touches[0]);});
    canvas.addEventListener('touchmove', e=>{updatePointer(e.touches[0]);});
    canvas.addEventListener('touchend', e=>{pointer.down=false;});
    function updatePointer(e){
      pointer.x = e.clientX; pointer.y = e.clientY;
    }

    // ì¶©ëŒ ê²€ì‚¬ (AABB)
    function isColliding(a,b){
      return !(
        a.x+a.size < b.x ||
        a.x     > b.x+b.size ||
        a.y+a.size < b.y ||
        a.y     > b.y+b.size
      );
    }

    // ì´ë¯¸ì§€ ë¡œë“œ
    const assetList = {
      bg:     'bg.png',
      player: 'player.png',
      zombie: 'zombie.png',
      rope:   'rope.png',
      prison: 'prison.png',
      swab:   'swab.png',
      nano:   'nano.png'
    };
    const assets = {};
    let loaded=0, total=Object.keys(assetList).length;
    for(let k in assetList){
      assets[k] = new Image();
      assets[k].src = assetList[k];
      assets[k].onload = ()=>{ if(++loaded===total) {/* ì¤€ë¹„ ì™„ë£Œ! */} }
    }

    // ìŠ¤í”„ë¼ì´íŠ¸ í¬ê¸°
    const SPR = { player:60, zombie:50, item:36 };

    // í”Œë ˆì´ì–´ í´ë˜ìŠ¤
    class Player {
      constructor(){
        this.size = SPR.player;
        this.x = WIDTH/2; this.y = HEIGHT/2;
        this.speed = 4;
        this.health = 2;
        this.ropeCount  = 0;
        this.nanoCount  = 0;
        this.captured   = 0;
        this.imprisoned = 0;
        this.score      = 0;
        this.invincibleTimer = 0;
      }
      update(){
        // í‚¤ë³´ë“œ ì´ë™
        if(keys['ArrowLeft']||keys['a']) this.x -= this.speed;
        if(keys['ArrowRight']||keys['d']) this.x += this.speed;
        if(keys['ArrowUp']||keys['w']) this.y -= this.speed;
        if(keys['ArrowDown']||keys['s']) this.y += this.speed;
        // ë§ˆìš°ìŠ¤/í„°ì¹˜ ì´ë™
        if(pointer.down){
          const dx = pointer.x - this.x, dy = pointer.y - this.y;
          const dist = Math.hypot(dx,dy)||1;
          this.x += dx/dist * this.speed;
          this.y += dy/dist * this.speed;
        }
        // í™”ë©´ ë°– ë°©ì§€
        this.x = Math.max(0, Math.min(WIDTH - this.size, this.x));
        this.y = Math.max(0, Math.min(HEIGHT - this.size, this.y));
        // ë¬´ì  íƒ€ì´ë¨¸ ê°ì†Œ
        if(this.invincibleTimer>0) this.invincibleTimer--;
      }
      draw(){
        // ê¹œë¹¡ì„ íš¨ê³¼
        if(this.invincibleTimer>0 && Math.floor(this.invincibleTimer/10)%2===0) return;
        ctx.drawImage(assets.player, this.x, this.y, this.size, this.size);
      }
    }

    // ì¢€ë¹„ í´ë˜ìŠ¤
    class Zombie {
      constructor(){
        this.size = SPR.zombie;
        this.reset();
        this.speed = 1.2;
      }
      reset(){
        this.x = Math.random()*(WIDTH - this.size);
        this.y = Math.random()*(HEIGHT - this.size);
      }
      update(p){
        const dx = p.x - this.x, dy = p.y - this.y;
        const dist = Math.hypot(dx,dy)||1;
        this.x += dx/dist * this.speed;
        this.y += dy/dist * this.speed;
      }
      draw(){
        ctx.drawImage(assets.zombie, this.x, this.y, this.size, this.size);
      }
    }

    // ì•„ì´í…œ í´ë˜ìŠ¤
    class Item {
      constructor(type){
        this.type = type;
        this.size = SPR.item;
        this.reset();
      }
      reset(){
        this.x = Math.random()*(WIDTH - this.size);
        this.y = Math.random()*(HEIGHT - this.size);
      }
      draw(){
        ctx.drawImage(assets[this.type], this.x, this.y, this.size, this.size);
      }
    }

    // ê²Œì„ ì‹œì‘ í•¨ìˆ˜
    function startGame(){
      const player = new Player();
      const zombies = Array.from({length:5},()=>new Zombie());
      const items   = Array.from({length:8},()=>new Item(['rope','prison','swab','nano'][Math.floor(Math.random()*4)]));
      const collected = { rope:0, prison:0, swab:0, nano:0 };

      function gameLoop(){
        // 1) ë°°ê²½ ê·¸ë¦¬ê¸°
        ctx.drawImage(assets.bg, 0,0, WIDTH, HEIGHT);

        // 2) ì—…ë°ì´íŠ¸
        player.update();
        zombies.forEach(z=>z.update(player));

        // 3) ì•„ì´í…œ ì¶©ëŒ & ë¦¬ìŠ¤í°
        items.forEach(it=>{
          if(isColliding(player,it)){
            // ê°œìˆ˜ ì¦ê°€
            collected[it.type]++;
            // íš¨ê³¼ ì ìš©
            switch(it.type){
              case 'rope':   player.ropeCount++;   break;
              case 'prison': if(player.captured>0){ player.imprisoned++; player.captured--; } break;
              case 'swab':   if(player.imprisoned>0){ player.score++; player.imprisoned--; } break;
              case 'nano':   player.nanoCount++;   break;
            }
            it.reset();
          }
        });

        // 4) ì¢€ë¹„ ì¶©ëŒ
        zombies.forEach(z=>{
          if(isColliding(player,z)){
            if(player.ropeCount>0){
              player.ropeCount--;
              player.captured++;
              z.reset();
            }
            else if(player.nanoCount>0){
              player.nanoCount--;
              player.invincibleTimer = FPS*3;
              // ì¢€ë¹„ëŠ” ë¦¬ì…‹í•˜ì§€ ì•ŠìŒ
            }
            else if(player.invincibleTimer===0){
              player.health--;
              player.invincibleTimer = FPS*3;
              z.reset();
            }
          }
        });

        // 5) ê·¸ë¦¬ê¸°
        player.draw();
        zombies.forEach(z=>z.draw());
        items.forEach(it=>it.draw());

        // 6) HUD
        document.getElementById('hud').innerHTML =
          `â¤ ì²´ë ¥: ${player.health}&nbsp;&nbsp;ğŸ”— ë¡œí”„: ${player.ropeCount}&nbsp;&nbsp;`+
          `ğŸ‘• ë‚˜ë…¸ì˜·: ${player.nanoCount}&nbsp;&nbsp;ğŸ“¦ ê°ì˜¥: ${player.imprisoned}&nbsp;&nbsp;`+
          `â­ ì ìˆ˜: ${player.score}<br>`+
          `íšë“â–¶ ë¡œí”„:${collected.rope} ê°ì˜¥:${collected.prison} ë©´ë´‰:${collected.swab} ë‚˜ë…¸:${collected.nano}`;

        // 7) ê²Œì„ ì˜¤ë²„
        if(player.health<=0){
          alert('ê²Œì„ ì˜¤ë²„!\nìµœì¢… ì ìˆ˜: '+player.score);
          window.location.reload();
          return;
        }

        requestAnimationFrame(gameLoop);
      }

      gameLoop();
    }

  })();
  </script>

</body>
</html>
